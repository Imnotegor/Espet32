# Features Schema v1

Контракт между ESP32 и PC trainer для входных признаков нейросети.

## Input Features (12 значений)

Все значения нормализованы в диапазон `[0.0, 1.0]` если не указано иное.

| # | Название | Описание | Диапазон |
|---|----------|----------|----------|
| 0 | `hunger` | Уровень голода | 0 = сыт, 1 = голоден |
| 1 | `energy` | Уровень энергии | 0 = устал, 1 = бодрый |
| 2 | `affection_need` | Потребность в ласке | 0 = доволен, 1 = хочет внимания |
| 3 | `trust` | Доверие к хозяину | 0 = не доверяет, 1 = полное доверие |
| 4 | `stress` | Уровень стресса | 0 = спокоен, 1 = нервничает |
| 5 | `dt_seconds_norm` | Время с последнего взаимодействия | 0 = только что, 1 = 10+ минут |
| 6 | `feed_count_5m_norm` | Кормлений за 5 минут | 0 = нет, 1 = 10+ раз |
| 7 | `pet_count_5m_norm` | Поглаживаний за 5 минут | 0 = нет, 1 = 10+ раз |
| 8 | `ignore_time_norm` | Время игнорирования | 0 = нет, 1 = 5+ минут |
| 9 | `time_of_day_sin` | sin(время суток) | [-1, 1] |
| 10 | `time_of_day_cos` | cos(время суток) | [-1, 1] |
| 11 | `spam_score_norm` | Оценка спама кнопок | 0 = норма, 1 = спам |

## Output (10 значений)

| # | Название | Описание | Активация |
|---|----------|----------|-----------|
| 0-7 | `action_logits[8]` | Логиты действий | softmax |
| 8 | `valence` | Настроение | tanh → [-1, 1] |
| 9 | `arousal` | Возбуждение | sigmoid → [0, 1] |

## Actions (8 действий)

| ID | Название | Описание |
|----|----------|----------|
| 0 | `SLEEP` | Питомец спит |
| 1 | `IDLE` | Бездействие |
| 2 | `PLAY` | Играет |
| 3 | `ASK_FOOD` | Просит еду |
| 4 | `ASK_PET` | Просит ласку |
| 5 | `HAPPY` | Радуется |
| 6 | `ANNOYED` | Раздражен |
| 7 | `SAD` | Грустит |

## Пример

```json
{
  "features": [0.3, 0.7, 0.2, 0.5, 0.1, 0.05, 0.1, 0.0, 0.0, 0.5, 0.87, 0.0],
  "output": {
    "action_probs": [0.01, 0.60, 0.20, 0.02, 0.02, 0.10, 0.03, 0.02],
    "valence": 0.3,
    "arousal": 0.4
  }
}
```

## Версионирование

- **Features Schema Version**: 1
- При изменении схемы увеличить версию
- ESP32 проверяет `features_version` при загрузке модели
- Несовместимые версии отклоняются
